<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>epic-4</epicId>
    <storyId>4.2</storyId>
    <title>Future Date Context Switching</title>
    <status>drafted</status>
    <generatedAt>2025-11-30</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/4-2-future-date-context-switching.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>User</asA>
    <iWant>to select a future date from the forecast list</iWant>
    <soThat>I can see the dashboard conditions for that specific night</soThat>
    <tasks>
- Task 1: Implement `DateNotifier` (AC: 1)
- Task 2: Update `ForecastScreen` (AC: 1, 2)
- Task 3: Update `HomeScreen` for Future Context (AC: 3, 4)
    </tasks>
  </story>

  <acceptanceCriteria>
1. **Future Date Context:**
   - [ ] Tapping a forecast item updates the global `dateProvider`.
   - [ ] App navigates to a view showing the Dashboard for that specific date.
   - [ ] The Dashboard clearly indicates it is showing "Future Data" (e.g., distinct header or banner).
   - [ ] "Top 3 Objects" and "Bortle/Cloud" bars update to reflect the future date's conditions.
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-4.md</path>
        <title>Epic Technical Specification: Planning & Forecast</title>
        <section>Detailed Design</section>
        <snippet>Defines "Future Date Context Switching" mechanism to update the global app state (Location/Date) to a selected future date.</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document</title>
        <section>7-Day Forecast</section>
        <snippet>FR11: Users can tap a specific day to view a detailed dashboard.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Document</title>
        <section>System Architecture</section>
        <snippet>Describes the use of Riverpod for global state management.</snippet>
      </doc>
    </docs>
    <code>
      <item>
        <path>lib/features/dashboard/presentation/home_screen.dart</path>
        <kind>widget</kind>
        <symbol>HomeScreen</symbol>
        <reason>Needs to be updated to watch `dateProvider` and display future data indicator.</reason>
      </item>
      <item>
        <path>lib/features/planner/presentation/pages/forecast_screen.dart</path>
        <kind>widget</kind>
        <symbol>ForecastScreen</symbol>
        <reason>Needs to handle tap events on forecast items to update `dateProvider`.</reason>
      </item>
      <item>
        <path>lib/core/widgets/glass_panel.dart</path>
        <kind>widget</kind>
        <symbol>GlassPanel</symbol>
        <reason>Reusable UI component for the "Future Data" banner.</reason>
      </item>
      <item>
        <path>lib/features/planner/domain/entities/daily_forecast.dart</path>
        <kind>entity</kind>
        <symbol>DailyForecast</symbol>
        <reason>Data model for the forecast items.</reason>
      </item>
    </code>
    <dependencies>
      <dep>flutter_riverpod</dep>
    </dependencies>
  </artifacts>

  <constraints>
    - `DateNotifier` must be a global provider in `lib/core/providers`.
    - `HomeScreen` must react to date changes without full reload if possible, or handle reload gracefully.
    - Use `GlassPanel` for the "Future Data" banner to maintain "Astr Aura" theme.
  </constraints>
  <interfaces>
    <interface>
      <name>DateNotifier</name>
      <kind>Riverpod Notifier</kind>
      <signature>class DateNotifier extends Notifier&lt;DateTime&gt;</signature>
      <path>lib/core/providers/date_provider.dart</path>
    </interface>
  </interfaces>
  <tests>
    <standards>Unit tests for Provider. Widget tests for Screen interactions.</standards>
    <locations>test/core/providers, test/features/planner, test/features/dashboard</locations>
    <ideas>
      - Verify `DateNotifier` updates state correctly.
      - Verify `ForecastScreen` tap updates provider and triggers navigation.
      - Verify `HomeScreen` displays banner when date is not today.
    </ideas>
  </tests>
</story-context>
