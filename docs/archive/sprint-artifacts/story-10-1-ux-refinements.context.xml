<story_context>
  <story_meta>
    <epic_id>10</epic_id>
    <story_id>10.1</story_id>
    <story_key>10-1-ux-refinements</story_key>
    <story_title>UX Refinements</story_title>
    <status>ready-for-dev</status>
  </story_meta>

  <user_story>
    <as_a>User</as_a>
    <i_want>a polished, frustration-free experience</i_want>
    <so_that>I enjoy using the app without annoyances</so_that>
  </user_story>

  <acceptance_criteria>
    <criterion id="1">
      <description>Delete Saved Location: UI has delete action, logic updates Hive, state handles current location deletion.</description>
    </criterion>
    <criterion id="2">
      <description>Reverse Geocoding: Fetch and display city/place name using OpenStreetMap Nominatim API. Cache results.</description>
    </criterion>
    <criterion id="3">
      <description>Night-Only Display Mode: Define Night as Sunset to Sunrise. Filter graphs and forecast to show only this range. Remove 24h view.</description>
    </criterion>
  </acceptance_criteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/epics.md</path>
        <title>Epics & Stories</title>
        <section>Epic 10: Production Polish & Launch</section>
        <snippet>Goal: Finalize the app for store release, addressing UX gaps. Story 10.1 focuses on Delete Location, Location Names, and Night-Only Mode.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Document</title>
        <section>7. Data Architecture</section>
        <snippet>Local Storage (Hive): Box `locations` stores list of `SavedLocation` objects. Networking: Dio for HTTP client.</snippet>
      </doc>
    </docs>

    <code>
      <item>
        <path>lib/features/profile/presentation/providers/saved_locations_provider.dart</path>
        <kind>provider</kind>
        <symbol>SavedLocationsNotifier</symbol>
        <reason>Manages the list of saved locations. Needs `deleteLocation` method.</reason>
      </item>
      <item>
        <path>lib/features/profile/presentation/screens/locations_screen.dart</path>
        <kind>widget</kind>
        <symbol>LocationsScreen</symbol>
        <reason>Displays the list of locations. Needs Swipe-to-Delete UI.</reason>
      </item>
      <item>
        <path>lib/features/catalog/presentation/widgets/visibility_graph_painter.dart</path>
        <kind>painter</kind>
        <symbol>VisibilityGraphPainter</symbol>
        <reason>Renders the visibility graph. Needs to be updated to support custom X-axis range (Sunset-Sunrise).</reason>
      </item>
      <item>
        <path>lib/features/context/domain/entities/geo_location.dart</path>
        <kind>entity</kind>
        <symbol>GeoLocation</symbol>
        <reason>Data model for location. Needs `placeName` field added.</reason>
      </item>
    </code>

    <dependencies>
      <package name="dio" version="^5.0.0" />
      <package name="hive" version="^2.2.3" />
      <package name="intl" version="^0.18.0" />
    </dependencies>
  </artifacts>

  <interfaces>
    <interface>
      <name>Nominatim API</name>
      <kind>REST</kind>
      <signature>GET https://nominatim.openstreetmap.org/reverse?lat={lat}&lon={lon}&format=json</signature>
      <path>External API</path>
    </interface>
  </interfaces>

  <constraints>
    <constraint>Reverse geocoding must use OpenStreetMap Nominatim API (Free).</constraint>
    <constraint>Must include `User-Agent: Astr/1.0` header in Nominatim requests.</constraint>
    <constraint>Cache geocoding results to avoid rate limiting (Max 1 req/sec).</constraint>
    <constraint>Night mode definition: Sunset to Sunrise (handle cross-midnight).</constraint>
  </constraints>

  <testing>
    <standards>Unit tests for Notifiers and Services. Widget tests for UI interactions.</standards>
    <locations>test/features/profile, test/features/dashboard</locations>
    <ideas>
      <idea id="1">Test `deleteLocation` removes item from Hive and updates state.</idea>
      <idea id="2">Test `GeocodingService` returns correct city name and handles errors.</idea>
      <idea id="3">Test `VisibilityGraphPainter` correctly maps X-axis for a night-only range.</idea>
    </ideas>
  </testing>
</story_context>
