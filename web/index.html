<!DOCTYPE html>
<html lang="en">
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <meta name="description" content="Astr - Plan perfect stargazing sessions with real-time light pollution zones, celestial object catalog, weather forecasts, and astronomical event tracking.">
  <meta name="theme-color" content="#0A0A0B">
  <meta name="color-scheme" content="dark">

  <!-- Open Graph / Social -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Astr - Stargazing Planner">
  <meta property="og:description" content="Plan perfect stargazing sessions with real-time light pollution data, celestial catalog, and weather forecasts.">
  <meta property="og:image" content="icons/Icon-512.png">
  <meta property="og:url" content="https://astr.app">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Astr - Stargazing Planner">
  <meta name="twitter:description" content="Plan perfect stargazing sessions with real-time light pollution data, celestial catalog, and weather forecasts.">

  <!-- iOS meta tags & icons -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Astr">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.png"/>
  <link rel="icon" type="image/png" sizes="192x192" href="icons/Icon-192.png"/>

  <title>Astr - Stargazing Planner</title>
  <link rel="manifest" href="manifest.json">

  <!-- Desktop browser gate: show message on non-touch devices -->
  <style>
    #desktop-gate {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 99999;
      background: #0A0A0B;
      color: #E5E7EB;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 2rem;
    }
    #desktop-gate h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, #60A5FA, #818CF8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    #desktop-gate p {
      font-size: 1.1rem;
      color: #9CA3AF;
      max-width: 480px;
      line-height: 1.6;
    }
    #desktop-gate .emoji {
      font-size: 4rem;
      margin-bottom: 1rem;
    }
    #desktop-gate .store-links {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    #desktop-gate .store-links a {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      background: #1F2937;
      color: #E5E7EB;
      text-decoration: none;
      font-weight: 500;
      transition: background 0.2s;
    }
    #desktop-gate .store-links a:hover {
      background: #374151;
    }
  </style>
  <script>
    // Detect non-touch desktop browsers (not tablets or phones)
    function isDesktopBrowser() {
      var hasTouch = ('ontouchstart' in window) ||
                     (navigator.maxTouchPoints > 0) ||
                     (navigator.msMaxTouchPoints > 0);
      var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      // iPads with desktop UA still have touch
      return !hasTouch && !isMobile;
    }
    var _astrIsDesktop = isDesktopBrowser();
    if (_astrIsDesktop) {
      document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('desktop-gate').style.display = 'flex';
      });
    }
  </script>
</head>
<body>
  <div id="desktop-gate">
    <div class="emoji">üî≠</div>
    <h1>Astr</h1>
    <p>Astr is designed for touchscreen devices. For the best stargazing planning experience, please use your phone or tablet.</p>
    <div class="store-links">
      <a href="https://play.google.com/store/apps/details?id=com.astr.app" target="_blank" rel="noopener">
        üì± Google Play
      </a>
      <a href="https://apps.apple.com/app/astr" target="_blank" rel="noopener">
        üçé App Store
      </a>
    </div>
  </div>
  <script>
    // Only load Flutter on touch-capable devices
    if (!_astrIsDesktop) {
      var s = document.createElement('script');
      s.src = 'flutter_bootstrap.js';
      s.async = true;
      document.body.appendChild(s);
    }

    // PWA auto-update: detect new service worker and activate immediately
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.ready.then(function(registration) {
        registration.addEventListener('updatefound', function() {
          var newWorker = registration.installing;
          if (!newWorker) return;
          newWorker.addEventListener('statechange', function() {
            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
              // New version available - activate it immediately
              newWorker.postMessage({ type: 'SKIP_WAITING' });
            }
          });
        });
      });
      // Reload once the new service worker takes over
      var refreshing = false;
      navigator.serviceWorker.addEventListener('controllerchange', function() {
        if (!refreshing) {
          refreshing = true;
          window.location.reload();
        }
      });
    }
  </script>
</body>
</html>
